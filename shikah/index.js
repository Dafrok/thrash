window.addEventListener('resize', resize, false);

var letters = [];

var fontInput = document.getElementById("font-input");
var textInput = document.getElementById("text-input");
var checkBox = document.getElementById("vertical");

var bgImage;

var charSize = 65;
var cellSize = charSize / 7;

fontInput.oninput = function () {
    charSize = parseInt(fontInput.value);
    cellSize = charSize / 7;
    loop();
}

textInput.oninput = function () {
    parseText();
    loop();
}

checkBox.onclick = function () {
    loop();
}

//0 = blank, 1 = square, 
//2 = BL, 3 = BR,
//4 = TL, 5 = TR
var shiekah = [
    [
        [2, 0, 2, 1, 1, 1, 3],
        [1, 0, 1, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 0, 0, 1],
        [1, 0, 4, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//a
    [
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 1, 5, 0, 4, 1, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 0, 1, 1, 1, 0, 5]
    ],//b
    [
        [2, 1, 3, 0, 2, 1, 3],
        [0, 0, 1, 0, 1, 0, 0],
        [2, 1, 5, 0, 4, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 3, 0, 2, 1, 5],
        [0, 0, 1, 0, 1, 0, 0],
        [4, 1, 5, 0, 4, 1, 5]
    ],//c
    [
        [2, 1, 1, 1, 1, 1, 3],
        [0, 0, 0, 0, 0, 0, 1],
        [1, 1, 1, 1, 3, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [1, 1, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [4, 1, 1, 1, 5, 0, 5]
    ],//d
    [
        [1, 0, 2, 1, 3, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 3, 0, 2, 1, 5],
        [0, 0, 1, 0, 1, 0, 0],
        [4, 1, 5, 0, 4, 1, 5]
    ],//e
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 3, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 1, 5, 0, 4, 1, 5]
    ],//f
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 3, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 1, 5, 0, 1, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [4, 1, 1, 1, 5, 0, 5]
    ],//g
    [
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 3, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 0, 1, 0, 1, 0, 5]
    ],//h
    [
        [2, 1, 3, 0, 2, 1, 3],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 4, 1, 5, 0, 1]
    ],//i
    [
        [2, 0, 1, 1, 1, 1, 3],
        [1, 0, 1, 0, 0, 0, 1],
        [4, 1, 5, 0, 3, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [4, 1, 1, 1, 5, 0, 1]
    ],//j
    [
        [2, 0, 1, 0, 1, 0, 3],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 0, 1, 0, 1, 0, 5]
    ],//k
    [
        [2, 0, 2, 1, 1, 1, 3],
        [1, 0, 1, 0, 0, 0, 0],
        [1, 0, 1, 0, 1, 1, 1],
        [1, 0, 1, 0, 0, 0, 0],
        [4, 1, 5, 0, 1, 1, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 1, 5]
    ],//l
    [
        [2, 1, 1, 1, 1, 1, 3],
        [0, 0, 0, 0, 0, 0, 0],
        [1, 1, 3, 0, 2, 1, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 1, 5]
    ],//m
    [
        [2, 1, 3, 0, 1, 0, 3],
        [0, 0, 1, 0, 1, 0, 1],
        [1, 1, 5, 0, 1, 0, 1],
        [0, 0, 0, 0, 1, 0, 1],
        [2, 1, 1, 1, 5, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//n
    [
        [2, 0, 1, 0, 1, 0, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 3, 0, 2, 1, 5],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 0, 4, 1, 5, 0, 5]
    ],//o
    [
        [2, 0, 1, 1, 1, 0, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//p
    [
        [1, 0, 1, 0, 1, 0, 3],
        [0, 0, 0, 0, 1, 0, 1],
        [2, 1, 1, 1, 5, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 0, 1, 0, 1, 0, 5]
    ],//q
    [
        [2, 1, 3, 0, 2, 1, 3],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 4, 1, 5, 0, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [1, 1, 3, 0, 2, 1, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 4, 1, 5, 0, 1]
    ],//r
    [
        [2, 1, 1, 0, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 0, 1, 1, 5]
    ],//s
    [
        [2, 0, 1, 1, 1, 0, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 3, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 1, 5, 0, 4, 1, 5],
        [0, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 1, 5]
    ],//t
    [
        [2, 1, 1, 1, 3, 0, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 1, 5, 0, 1],
        [0, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 1, 5]
    ],//u
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 1, 1, 5],
        [1, 0, 1, 0, 0, 0, 0],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [4, 0, 1, 0, 1, 0, 5]
    ],//v
    [
        [2, 1, 3, 0, 2, 1, 3],
        [0, 0, 1, 0, 1, 0, 0],
        [2, 0, 1, 0, 1, 0, 3],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 4, 1, 5, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//w
    [
        [2, 1, 3, 0, 2, 1, 3],
        [0, 0, 1, 0, 1, 0, 0],
        [1, 0, 4, 1, 5, 0, 1],
        [1, 0, 0, 0, 0, 0, 1],
        [1, 0, 2, 1, 3, 0, 1],
        [0, 0, 1, 0, 1, 0, 0],
        [4, 1, 5, 0, 4, 1, 5]
    ],//x
    [
        [2, 1, 3, 0, 2, 0, 3],
        [0, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 0],
        [4, 0, 5, 0, 4, 1, 5]
    ],//y
    [
        [2, 1, 1, 1, 1, 1, 3],
        [0, 0, 0, 0, 0, 0, 1],
        [2, 1, 3, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 4, 1, 5],
        [1, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 1, 5]
    ],//z
    [
        [1, 0, 1, 1, 1, 1, 3],
        [0, 0, 0, 0, 0, 0, 1],
        [0, 0, 0, 0, 0, 0, 1],
        [2, 1, 1, 1, 1, 1, 5],
        [1, 0, 0, 0, 0, 0, 0],
        [1, 0, 0, 0, 0, 0, 0],
        [4, 1, 1, 1, 1, 0, 1]
    ],//-
    [
        [2, 1, 1, 3, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [4, 0, 0, 4, 1, 1, 5]
    ],//fullstop
    [
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0]
    ],//space
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 0, 1, 4, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 3, 1, 0, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//0
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 0, 1, 0, 1, 4, 1],
        [1, 1, 1, 0, 1, 0, 1],
        [1, 0, 0, 2, 1, 0, 1],
        [1, 1, 1, 1, 1, 0, 1],
        [1, 3, 0, 0, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//1
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 1, 0, 1, 4, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 3, 0, 0, 0, 2, 1],
        [1, 1, 1, 1, 1, 1, 1],
        [1, 3, 0, 0, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//2
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 1, 1],
        [1, 0, 1, 3, 0, 0, 1],
        [1, 0, 1, 1, 1, 1, 1],
        [1, 3, 0, 0, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//3
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 4, 1, 4, 1],
        [1, 1, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 1, 1, 0, 1, 0, 1],
        [1, 3, 0, 2, 1, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//4
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 0, 0, 4, 1],
        [1, 0, 1, 1, 1, 1, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 1, 1, 1, 1, 0, 1],
        [1, 3, 0, 0, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//5
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 1, 5, 0, 4, 1],
        [1, 0, 1, 0, 1, 1, 1],
        [1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 1, 1],
        [1, 3, 1, 3, 0, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//6
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 0, 0, 4, 1],
        [1, 1, 1, 1, 1, 0, 1],
        [1, 0, 0, 4, 1, 0, 1],
        [1, 1, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//7
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 0, 0, 4, 1],
        [1, 1, 1, 1, 1, 1, 1],
        [1, 5, 0, 0, 0, 4, 1],
        [1, 0, 1, 1, 1, 0, 1],
        [1, 3, 1, 0, 1, 2, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//8
    [
        [2, 1, 1, 1, 1, 1, 3],
        [1, 5, 0, 0, 0, 4, 1],
        [1, 0, 1, 1, 1, 1, 1],
        [1, 0, 1, 5, 0, 0, 1],
        [1, 0, 1, 0, 1, 1, 1],
        [1, 3, 1, 0, 1, 0, 1],
        [4, 1, 1, 1, 1, 1, 5]
    ],//9
    [
        [2, 1, 1, 3, 0, 0, 3],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [1, 0, 0, 1, 0, 0, 1],
        [4, 0, 0, 4, 1, 1, 5]
    ],//!
    [
        [1, 0, 0, 2, 1, 1, 3],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [1, 0, 0, 1, 0, 0, 1],
        [0, 0, 0, 1, 0, 0, 0],
        [0, 0, 0, 1, 0, 0, 0],
        [4, 1, 1, 5, 0, 0, 1]
    ],//?
]

function Point(x, y) {
    this.x = x;
    this.y = y;
}

function Letter(index) {
    this.index = index;
}

Letter.prototype.render = function (x, y) {
    var char = shiekah[this.index];

    noStroke();
    fill(185, 41, 100);
    for (var i = 0; i < char.length; i++) {
        var row = char[i];
        for (var j = 0; j < row.length; j++) {
            var x1 = x + j * cellSize - 1;
            var x2 = x + (j + 1) * cellSize;
            var y1 = y + i * cellSize - .5;
            var y2 = y + (i + 1) * cellSize;
            switch (row[j]) {
                case 1:
                    rect(x1, y1, cellSize + .5, cellSize + .5);
                    break;
                case 2:
                    triangle(x1, y2, x2, y2, x2, y1);
                    break;
                case 3:
                    triangle(x1, y1, x1, y2, x2, y2);
                    break;
                case 4:
                    triangle(x1, y1, x2, y2, x2, y1);
                    break;
                case 5:
                    triangle(x1, y1, x1, y2, x2, y1);
                    break;
            }
        }
    }
}

function setup() {
    createCanvas();
    colorMode(HSB, 360, 100, 100, 100);
    ellipseMode(CENTER);
    resize();
    parseText();
}

function parseText() {
    letters = [];
    var word = [];
    letters.push(word);
    var text = textInput.value.toLowerCase();
    for (var i = 0; i < text.length; i++) {
        var c = text.charCodeAt(i);
        if (c >= 97 && c <= 122) word.push(new Letter(c - 97));
        else if (c >= 48 && c <= 57) word.push(new Letter(c - 48 + 29));
        else if (c == 45) word.push(new Letter(26));
        else if (c == 46) word.push(new Letter(27));
        else if (c == 33) word.push(new Letter(39));
        else if (c == 63) word.push(new Letter(40));
        else if (c == 32 || c == 10) {
            if (c == 10) word.push(new Letter(-1));
            letters.push([]);
            word = letters[letters.length - 1];
        }
    }
    console.log(letters);
}

function draw() {
    clear();

    var maxX = floor((width - 40) / (charSize + cellSize * 2));
    var buffer = 20;
    var xOffset = buffer;
    var yOffset = buffer;
    var offset = charSize + cellSize * 2;
    for (var i = 0; i < letters.length; i++) {
        var word = letters[i];
        var test = width;
        if (checkBox.checked) test = height;
        if (i != 0 && xOffset != buffer) {
            xOffset += offset;
            if (word.length * offset + buffer < test && xOffset + offset * word.length > test) {
                xOffset = buffer;
                yOffset += offset;
            }
        }
        for (var j = 0; j < word.length; j++) {
            if (word[j].index != -1) {
                if (checkBox.checked) word[j].render(yOffset, xOffset);
                else word[j].render(xOffset, yOffset);
            }
            xOffset += offset;
            if (xOffset + charSize + buffer > test || word[j].index == -1) {
                xOffset = buffer;
                yOffset += offset;
            }
        }

    }
    // filter(BLUR, 1);
    noLoop();
}

function resize() {
    resizeCanvas(window.innerWidth, window.innerHeight);
}